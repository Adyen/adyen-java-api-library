/*
 * Configuration API
 *
 * The version of the OpenAPI document: 2
 *
 *
 * NOTE: This class is auto generated by OpenAPI Generator (https://openapi-generator.tech).
 * https://openapi-generator.tech
 * Do not edit the class manually.
 */

package com.adyen.service.balanceplatform;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertNotNull;
import static org.mockito.Mockito.verify;

import com.adyen.BaseTest;
import com.adyen.Client;
import com.adyen.constants.ApiConstants;
import com.adyen.model.balanceplatform.*;
import java.time.OffsetDateTime;
import java.util.Map;
import org.junit.Test;

public class TransferLimitsBalancePlatformLevelApiTest extends BaseTest {

  @Test
  public void createTransferLimitTest() throws Exception {
    Client client = createMockClientFromFile("mocks/balancePlatform/TransferLimit.json");
    TransferLimitsBalancePlatformLevelApi service =
        new TransferLimitsBalancePlatformLevelApi(client);

    String balancePlatform = "MY_BALANCE_PLATFORM";
    CreateTransferLimitRequest createTransferLimitRequest =
        new CreateTransferLimitRequest()
            .amount(new Amount().value(10000L).currency("EUR"))
            .scope(Scope.PERTRANSACTION)
            .reference("Your reference for the Transfer Limit")
            .scaInformation(new CreateScaInformation().scaOnApproval(true))
            .startsAt(OffsetDateTime.of(2025, 1, 1, 0, 0, 0, 0, OffsetDateTime.now().getOffset()))
            .endsAt(OffsetDateTime.of(2025, 6, 1, 0, 0, 0, 0, OffsetDateTime.now().getOffset()))
            .transferType(TransferType.ALL);

    TransferLimit transferLimit =
        service.createTransferLimit(balancePlatform, createTransferLimitRequest);

    verify(client.getHttpClient())
        .request(
            "https://balanceplatform-api-test.adyen.com/bcl/v2/balancePlatforms/MY_BALANCE_PLATFORM/transferLimits",
            createTransferLimitRequest.toJson(),
            client.getConfig(),
            false,
            null,
            ApiConstants.HttpMethod.POST,
            null);
    assertNotNull(transferLimit);
    assertEquals("TRLI00000000000000000000000001", transferLimit.getId());
  }

  @Test
  public void deletePendingTransferLimitTest() throws Exception {
    Client client = createMockClientFromResponse("");

    TransferLimitsBalancePlatformLevelApi service =
        new TransferLimitsBalancePlatformLevelApi(client);
	  String balancePlatform = "MY_BALANCE_PLATFORM";
    String transferLimitId = "TRLI00000000000000000000000001";

    service.deletePendingTransferLimit(balancePlatform, transferLimitId);

    verify(client.getHttpClient())
        .request(
            "https://balanceplatform-api-test.adyen.com/bcl/v2/balancePlatforms/MY_BALANCE_PLATFORM/transferLimits/TRLI00000000000000000000000001",
            null,
            client.getConfig(),
            false,
            null,
            ApiConstants.HttpMethod.DELETE,
            null);
  }

  @Test
  public void getSpecificTransferLimitTest() throws Exception {
    Client client = createMockClientFromFile("mocks/balancePlatform/TransferLimit.json");
    TransferLimitsBalancePlatformLevelApi service =
        new TransferLimitsBalancePlatformLevelApi(client);
	  String balancePlatform = "MY_BALANCE_PLATFORM";
    String transferLimitId = "TRLI00000000000000000000000001";

    TransferLimit transferLimit =
        service.getSpecificTransferLimit(balancePlatform, transferLimitId);

    verify(client.getHttpClient())
        .request(
            "https://balanceplatform-api-test.adyen.com/bcl/v2/balancePlatforms/MY_BALANCE_PLATFORM/transferLimits/TRLI00000000000000000000000001",
            null,
            client.getConfig(),
            false,
            null,
            ApiConstants.HttpMethod.GET,
            null);
    assertNotNull(transferLimit);
    assertEquals("TRLI00000000000000000000000001", transferLimit.getId());
  }

  @Test
  public void getTransferLimitsTest() throws Exception {
    Client client = createMockClientFromFile("mocks/balancePlatform/TransferLimits.json");
    TransferLimitsBalancePlatformLevelApi service =
        new TransferLimitsBalancePlatformLevelApi(client);
	  String balancePlatform = "MY_BALANCE_PLATFORM";

    TransferLimitListResponse transferLimits = service.getTransferLimits(balancePlatform);

    verify(client.getHttpClient())
        .request(
            "https://balanceplatform-api-test.adyen.com/bcl/v2/balancePlatforms/MY_BALANCE_PLATFORM/transferLimits",
            null,
            client.getConfig(),
            false,
            null,
            ApiConstants.HttpMethod.GET,
            Map.of());
    assertNotNull(transferLimits);
    assertEquals(2, transferLimits.getTransferLimits().size());
    assertEquals(
        "TRLI00000000000000000000000001", transferLimits.getTransferLimits().get(0).getId());
  }
}
